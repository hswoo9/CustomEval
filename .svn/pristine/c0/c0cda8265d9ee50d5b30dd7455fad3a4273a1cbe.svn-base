package com.duzon.custom.common.utiles;

import com.jcraft.jsch.ChannelSftp;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.util.StringUtils;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;
import org.springframework.web.multipart.MultipartFile;

import javax.servlet.http.HttpServletRequest;
import java.io.*;
import java.nio.file.*;
import java.util.HashMap;
import java.util.Map;
import java.util.UUID;
import java.util.Vector;

public class ConvertUtil {

    public void StringToFileConverter(String signHwpFileData, String ext, Map<String, Object> params){
        HttpServletRequest servletRequest = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();

        try {
            String fileUUID = UUID.randomUUID() + "." + ext ;
            String signFilePath = signFilePathF(servletRequest, params);

            if(servletRequest.getServerName().contains("localhost") || servletRequest.getServerName().contains("127.0.0.1")){
                CommFileUtil CommFileUtil = new CommFileUtil();
                CommFileUtil.setServerSFSave(signHwpFileData, signFilePath, params.get("attch_file_seq").toString(), ext);
            }else{
                File newPath = new File(signFilePath);
                if (!newPath.exists()) {
                    newPath.mkdirs();
                }

                File lOutFile = new File(signFilePath + "/" + fileUUID);
                FileOutputStream lFileOutputStream = new FileOutputStream(lOutFile);
                lFileOutputStream.write(signHwpFileData.getBytes());
                lFileOutputStream.close();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public String signFilePathF(HttpServletRequest servletRequest, Map<String, Object> params){
        String path = "";

        path = "cust_eval/" + params.get("commissioner_seq").toString();

        if(servletRequest.getServerName().contains("localhost") || servletRequest.getServerName().contains("127.0.0.1")){
        }else{
            path = "/data/upload/" + path + "/";
        }

        return path;
    }
}
